#!/bin/bash

# Remember to put permissions
# In the Linux Terminal, do:
# chmod +x dns-zone-transfer.sh

# VARS
STR_R='REFUSED' # Used for parsing in the output. (REFUSED)
STR_N='' # Used for parsing in the output. (NOT FOUND)
COUNT=1 # Used for count the tryings.

# Check valid domain and show correct syntax.
if [ "$1" == "" ];then
	echo # Skip line
	echo "*** Jaads - Pentes [DNS ZONE TRANSFER] ***"
	echo "Run: $0 www.domain.com"
	echo # Skip line
else
	# If true, run script.
	echo # Skip line
	host -t ns $1 | cut -d " " -f4 > source # Save output in source file
	echo -e "\e[1;33m************************** NS FOUND ************************** \e[00m"
	cat source # Print content from source file
	echo -e "\e[1;33m************************** xxxx ************************** \e[00m"
	echo # Skip line
	for x in $(cat source) # parsing the content source file and try zone transfer
		do
			R=`host -l $1 $x` # Save command in R var
			if [[ "$R" == *"$STR_R"* ]];then # If False, print the result...
				echo -e "\e[1;31m[$COUNT] *********************** REFUSED *********************** \e[00m"
				echo -e "\e[1;31mZONE TRANSFER REFUSED: $x \e[00m"
				echo				
			elif [[ "$R" == "$STR_N" ]]; then # Test invalid domain
				echo -e "\e[1;31m[$COUNT] ********************** NOT FOUND ********************** \e[00m"
				echo -e "\e[1;31mZONE TRANSFER NOT FOUND: $x \e[00m"
				echo
			else # If True, print the result...
				echo -e "\e[1;32m[$COUNT] *********************** SUCCESS *********************** \e[00m"
				echo -e "\e[1;32mZONE TRANSFER ALLOWED: $x \e[00m"
				echo -e "\e[1;33m$R \e[00m"
				echo -e "\e[1;32m[$COUNT] *********************** SUCCESS *********************** \e[00m"
			fi
			((COUNT=COUNT+1)) # Count and increment
	done
	echo
fi